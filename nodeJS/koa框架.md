# koaÊ°ÜÊû∂
- koaÊ°ÜÊû∂ÂèØ‰ª•ÈÅøÂÖçÂºÇÊ≠•ÂµåÂ•ó
- ÂÆâË£ÖkoaÔºönpm install --save koa //--saveÂèÇÊï∞ÔºåË°®Á§∫Ëá™Âä®‰øÆÊîπpackage.jsonÊñá‰ª∂ÔºåËá™Âä®Ê∑ªÂä†‰æùËµñÈ°π

```
üå∞Ôºö
var koa = require('koa');
var app = new koa();

app.use(async(ctx)=>{
    ctx.body='hello koa';
});

app.listen(3031);
```

### koa-router Ë∑ØÁî±
- ÂÆâË£Ökoa-routerÔºönpm install --save koa-router 

#### GET 
```
üå∞Ôºö
const Koa = require('koa');
//ÂºïÂÖ•Âπ∂‰∏îÂÆû‰æãÂåñË∑ØÁî±
let router = require('koa-router')();//Áõ∏ÂΩì‰∫éconst Router = require('koa-router'); let router = new Router();

let app = new Koa();

//ÈÖçÁΩÆË∑ØÁî±ÔºåctxÊòØ‰∏ä‰∏ãÊñáÔºåÂåÖÂê´‰∫Ürequset‰ª•ÂèäresponseÁ≠â‰ø°ÊÅØ
//way1:
router.get('/',async (ctx)=>{
    ctx.body='È¶ñÈ°µ'; //ËøîÂõûÊï∞ÊçÆÔºåÁ±ª‰ºº‰∫éres.end()
});

router.get('/news',async (ctx)=>{    
    /**‰ªéctx‰∏≠ËØªÂèñget‰º†ÂÄº
     * query:ËøîÂõûÁöÑÊòØÊ†ºÂºèÂåñÂ•ΩÁöÑÂèÇÊï∞ÂØπË±°
     * queryString:ËøîÂõûÁöÑÊòØËØ∑Ê±ÇÂ≠óÁ¨¶‰∏≤
    */
   //Ëã•url=/news?type=first&name=new
   console.log(ctx.query);//{type:first,ame=new}
   console.log(ctx.querystring);//type=first&ame=new

    //ctx.requestËé∑ÂèñËØ∑Ê±ÇÁöÑËØ¶ÁªÜ‰ø°ÊÅØ
    console.log(ctx.request);

    ctx.body='news';
});

/*
way2:
router.get('/',async (ctx)=>{
    ctx.body='È¶ñÈ°µ'; //ËøîÂõûÊï∞ÊçÆÔºåÁ±ª‰ºº‰∫éres.end()
}).get('/news',async (ctx)=>{
    ctx.body='news';
});
*/

app.use(router.routes());//ÂêØÂä®Ë∑ØÁî±
app.use(router.allowedMethods);//ËØ•ÊÆµ‰ª£Á†ÅÂú®ÊâÄÊúâË∑ØÁî±‰∏≠Èó¥‰ª∂ÊúÄÂêéË∞ÉÁî®Ôºå‰ºöÊ†πÊçÆctx.statusËÆæÁΩÆresponseÂìçÂ∫îÂ§¥

app.listen(3031);
```

#### POST
```
üå∞Ôºö
const Koa = require('koa');
const Router = require('koa-router');
const common = require('./modules/common');
const views = require('koa-views');

let app = new Koa();
let router = new Router();

app.use(views('views',{  
    extension:'ejs'
}))

router.get('/',async (ctx)=>{
    let title = "hello"
    await ctx.render('index',{
        title:title //ÁªëÂÆöÊï∞ÊçÆ, ÂêëÂâçÂè∞‰º†ÈÄíÊï∞ÊçÆ
    });
});

router.get('/news',async (ctx)=>{
    ctx.body='news page';
});

router.post('/dologin',async (ctx)=>{
    //Êé•Êî∂postÊèê‰∫§ÁöÑÊï∞ÊçÆ„ÄÇÂõ†‰∏∫ÊòØÂºÇÊ≠•ÔºåÊâÄ‰ª•ÈúÄË¶ÅÂ∞ÅË£ÖÊé•Êî∂Êï∞ÊçÆÁöÑÊñπÊ≥ï
    let data = await common.getPostData(ctx);
    ctx.body = data;
})

app.use(router.routes());
app.use(router.allowedMethods);

app.listen(3031);
---------------------------------------------------------------------------------
common.js
exports.getPostData = function(ctx){
    return new Promise((resolve,reject)=>{
        let str = '';
        ctx.req.on('data',(data)=>{
            str+=data;
        });
        ctx.req.on('end',()=>{
            resolve(str);
        })
    })
}
```

#### Âä®ÊÄÅË∑ØÁî±
```
üå∞Ôºö
//Âä®ÊÄÅË∑ØÁî±ÔºåÂèØ‰ª•‰º†ÂÖ•Â§ö‰∏™ÂÄº
//‰æãÂ¶ÇÔºölocalhost:3031/newsContent/123 ctx.paramsÁöÑ‰º†ÂÄº‰∏∫{aid:'123'}
//Ëã•ÈúÄË¶Å‰º†ÈÄí‰∏§‰∏™ÂÄºÔºåÂèØÂÜô‰∏∫/newsContent/:aid/:cid
router.get('/newsContent/:aid',async (ctx)=>{
    console.log(ctx.params);//Ëé∑ÂèñÂä®ÊÄÅË∑ØÁî±ÁöÑ‰º†ÂÄº
    ctx.body = 'Êñ∞ÈóªËØ¶ÊÉÖ';
});
```

### koa ‰∏≠Èó¥‰ª∂
- ‰∏≠Èó¥‰ª∂ÔºöÂåπÈÖçË∑ØÁî±‰πãÂâçÊàñËÄÖÂåπÈÖçË∑ØÁî±ÂÆåÊàê‰πãÂêéÂÅöÁöÑ‰∏Ä‰∫õÊìç‰Ωú„ÄÇ
- Âú®Â§ö‰∏™‰∏≠Èó¥‰ª∂Êó∂ÔºåÊâßË°åÁöÑÈ°∫Â∫èÁ±ª‰ºº‰∫éÊ†à„ÄÇ
- ‰∏≠Èó¥‰ª∂ÂèØÂàÜ‰∏∫Ôºö
   1. Â∫îÁî®Á∫ß‰∏≠Èó¥‰ª∂
   2. Ë∑ØÁî±Á∫ß‰∏≠Èó¥‰ª∂
   3. ÈîôËØØÂ§ÑÁêÜ‰∏≠Èó¥‰ª∂
   4. Á¨¨‰∏âÊñπ‰∏≠Èó¥‰ª∂
```
üå∞Ôºö
//Êó†ËÆ∫app.useÁöÑ‰ΩçÁΩÆÂú®Âì™ÈáåÔºåÂú®koa‰∏≠ÈÉΩÊòØÂÖàÊâßË°åapp.useÂÜçÂåπÈÖçË∑ØÁî±
/**Â∫îÁî®Âèä‰∏≠Èó¥‰ª∂
 * app.use('/',(ctx,next)=>{}); ËØ•ÁßçÊñπÂºèË°®Á§∫Âè™ÂåπÈÖçÂÖ∂‰∏≠ÁöÑ‰∏ÄÁßçË∑ØÁî±ÔºåÂπ∂ÊâßË°åÂÖ∂‰∏≠ÁöÑÊñπÊ≥ï
 * app.use((ctx,next)=>{}); ËØ•ÁßçÊñπÂºèË°®Á§∫ÂåπÈÖçÊâÄÊúâÁöÑË∑ØÁî±ÔºåÂπ∂‰∏îÊâßË°åÂÖ∂‰∏≠ÁöÑÊñπÊ≥ï
 * nextË°®Á§∫ÂåπÈÖç‰∏ã‰∏Ä‰∏™Ë∑ØÁî±ÔºåËã•‰∏çÂÜônextÂèÇÊï∞ÔºåÂàô‰ºöÂåπÈÖçÂà∞Ëøô‰∏™Ë∑ØÁî±‰πãÂêé‰∏çÂÜçÂêë‰∏ãÂåπÈÖçË∑ØÁî±‰∫Ü
*/
app.use(async (ctx,next)=>{
    console.log('‰∏≠Èó¥‰ª∂');
    await next();
});

/**Ë∑ØÁî±‰∏≠Èó¥‰ª∂
 * ÂåπÈÖçÂà∞Á¨¶ÂêàÊù°‰ª∂ÁöÑË∑ØÁî±‰πãÂêéÂÜçÁªßÁª≠Âêë‰∏ãÂåπÈÖçË∑ØÁî±
 */
router.get('/news',async (ctx,next)=>{
    console.log('news page');
    await next();//ÁªßÁª≠Âêë‰∏ãÂåπÈÖç
});
router.get('/news',(ctx)=>{
    ctx.body='news page';
})

//ÈîôËØØÂ§ÑÁêÜ‰∏≠Èó¥‰ª∂
app.use(async (ctx,next)=>{
    console.log('‰∏≠Èó¥‰ª∂');//ÂÖàËæìÂá∫ ‰∏≠Èó¥‰ª∂
    next();// ÂæÄ‰∏ãÂåπÈÖçË∑ØÁî±

    //ÂåπÈÖçÂÆåÊàêË∑ØÁî±‰πãÂêéÂÜçËøõË°åÂà§Êñ≠
    if(ctx.status == 404){ //Ëã•ËØ•Ë∑ØÁî±Êü•ËØ¢‰∏çÂà∞
        ctx.status=404;
        ctx.body = 'ÈîôËØØÈ°µÈù¢'
    }else{
        console.log(ctx.url);
    }
})
```

#### Á¨¨‰∏âÊñπ‰∏≠Èó¥‰ª∂ koa-viewsËßÜÂõæÁÆ°ÁêÜÊ®°Âùó
- ÂÆâË£Ö: npm install koa-views --save
```
üå∞Ôºö
const Koa = require('koa');
const Router = require('koa-router');
//ÂºïÂÖ•koa-views
const views = require('koa-views');

let app = new Koa();
let router = new Router();

//ÈÖçÁΩÆÊ®°ÊùøÂºïÊìé‰∏≠Èó¥‰ª∂
//app.use(views('views',{map:{html:'ejs'}})); //ËøôÁßçÊñπÂºèÁöÑË∞ÉÁî®ÁöÑÊ®°ÊùøÁöÑÂêéÁºÄÂêç‰∏ÄÂÆöË¶ÅÊòØhtml
app.use(views('views',{   //ËøôÁßçÊñπÂºèË∞ÉÁî®Ê®°ÊùøÁöÑÂêéÁºÄÂêç‰∏∫ejs

    extension:'ejs'
}))
//ÈÖçÁΩÆÂÖ¨ÂÖ±Êï∞ÊçÆÁöÑ‰∏≠Èó¥‰ª∂
app.use(async (ctx,next)=>{
/*Ëã•Êàë‰ª¨ÈúÄË¶ÅÂú®ÊØè‰∏™Ë∑ØÁî±ÁöÑrenader‰∏≠ÈÉΩË¶ÅÊ∏≤Êüì‰∏Ä‰∏™ÂÖ¨ÂÖ±ÁöÑÊï∞ÊçÆÔºåÂèØ‰ª•Â∞ÜËØ•Êï∞ÊçÆÊîæÂú®ctx.state‰∏≠ÔºåËøôÊ†∑ÁöÑËØùÔºåÂ∞±ÂèØ‰ª•Âú®Ê®°ÊùøÁöÑ‰ªª‰ΩïÂú∞ÊñπË∞ÉÁî®Ëøô‰∏™Êï∞ÊçÆ*/
ctx.state ={
    name:'jack'
}
await next();
});

router.get('/',async (ctx)=>{
    let title = "hello"
    await ctx.render('index',{
        title:title //ÁªëÂÆöÊï∞ÊçÆ, ÂêëÂâçÂè∞‰º†ÈÄíÊï∞ÊçÆ
    });
});

router.get('/news',(ctx)=>{
    ctx.body='news page';
});


app.use(router.routes());
app.use(router.allowedMethods);

app.listen(3031);
```

#### Á¨¨‰∏âÊñπ‰∏≠Èó¥‰ª∂ koa-bodyparser
- ÂÆâË£Ö: npm install koa-bodyparser --save
```
üå∞Ôºö
//ÂèØ‰ª•ÁÆÄÁï•postËØ∑Ê±Ç
const Koa = require('koa');
const Router = require('koa-router');
const views = require('koa-views');
//ÂºïÂÖ•koa-bodyparser
const bodyParser = require('koa-bodyparser');


let app = new Koa();
let router = new Router();

app.use(views('views',{  
    extension:'ejs'
}))

//ÈÖçÁΩÆbodyparser
app.use(bodyParser());

router.get('/',async (ctx)=>{
    let title = "hello"
    await ctx.render('index',{
        title:title 
    });
});

router.post('/dologin',async (ctx)=>{
   //Áõ¥Êé•ÂºïÁî®
    ctx.body = ctx.request.body; //ËøîÂõûÁöÑÂÄº‰∏∫object
})

app.use(router.routes());
app.use(router.allowedMethods);

app.listen(3031);

```

#### koa-static ÈùôÊÄÅËµÑÊ∫ê‰∏≠Èó¥‰ª∂
- ÂÆâË£ÖÔºönpm install koa-static --save
```
üå∞Ôºö
const Koa = require('koa');
const Router = require('koa-router');
const views = require('koa-views');
const bodyParser = require('koa-bodyparser');
//ÂºïÂÖ•koa-static
const static = require('koa-static');

let app = new Koa();
let router = new Router();

app.use(views('views',{  
    extension:'ejs'
}))

//ÈÖçÁΩÆkoa-static‰∏≠Èó¥‰ª∂ÔºåÊåáÂÆöÁõÆÂΩï
//Ëã•ËØ∑Ê±ÇÁöÑÂú∞ÂùÄ‰∏∫localhost:3031/basic.cssÔºåÈ¶ñÂÖà‰ºöÂú®staticÁõÆÂΩï‰∏ãÂØªÊâæÊòØÂê¶ÊúâËØ•Êñá‰ª∂ÔºåËã•ÊúâÂàôËøîÂõûËØ•Êñá‰ª∂„ÄÇËã•Ê≤°ÊúâÂàôÊâßË°ånext()
app.use(static('./static'));//way1
app.use(static(__dirname+'/static'));//way2,__dirnameÊòØÂΩìÂâçÊñá‰ª∂ÁöÑÂú∞ÂùÄ

app.use(bodyParser());


router.get('/',async (ctx)=>{
    let title = "hello"
    await ctx.render('index',{
        title:title 
    });
});

router.post('/dologin',async (ctx)=>{
    ctx.body = ctx.request.body;
})

app.use(router.routes());
app.use(router.allowedMethods);

app.listen(3031);
--------------------------------------------------------------------------------
//EJS‰∏≠
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!--
        1.Ëã•Áõ¥Êé•‰ΩøÁî®ÔºåÊó†Ê≥ïÂºïÂÖ•css„ÄÇÂõ†‰∏∫Âú®Ë∑ØÁî±‰∏≠Âπ∂Ê≤°ÊúâÂ§ÑÁêÜËØ∑Ê±Çbasic.cssÁöÑÂú∞ÂùÄÁöÑË∑ØÁî±ÔºåÂèØ‰ª•‰ΩøÁî®koa-static‰∏≠Èó¥‰ª∂Ëß£ÂÜ≥Ëøô‰∏™ÈóÆÈ¢ò
        2.Âõ†‰∏∫Âú®ÈÖçÁΩÆkoa-static‰∏≠Èó¥‰ª∂ÁöÑÊó∂ÂÄôÂ∑≤ÁªèÊåáÂÆö‰∫ÜÁõÆÂΩïÔºåÊâÄ‰ª•Ëøô‰∏™hrefÁöÑÂú∞ÂùÄÊòØÁõ∏ÂØπ‰∫éÊåáÂÆöÁõÆÂΩïÁöÑÂú∞ÂùÄ„ÄÇ
    -->
    <link rel="stylesheet" href="basic.css"> 
</head>
<body>
   <h2><%=title%></h2> 
   <form action="/dologin" method="post">
        account:<input type="text" name="account" id="account">
        password:<input type="password" name="password" id="password">
        <input type="submit" value="submit">
   </form>
</body>
</html>
```

### art-template Ê®°ÊùøÂºïÊìé
- ÂÆâË£ÖÔºö1. npm install art-template --save
        2. npm install koa-art-template --save
```
const render = require('koa-art-template');

render(app,{
    root:path.join(__dirname,'view'), //ËßÜÂõæÁöÑ‰ΩçÁΩÆ
    extname:'.art', //ÂêéÁºÄÂêç
    debug: process.env.NODE_ENV !== 'production' //ÊòØÂê¶ÂºÄÂêØË∞ÉËØïÊ®°Âºè
});

üå∞Ôºö
js:
const Koa = require('koa');
const Router = require('koa-router');
const path=require("path");
//ÂºïÂÖ•koa-art-template
const render = require('koa-art-template');

let app = new Koa();
let router = new Router();

render(app,{
    root:path.join(__dirname,'views'), //ËßÜÂõæÁöÑ‰ΩçÁΩÆ
    extname:'.html', //ÂêéÁºÄÂêç
    debug: process.env.NODE_ENV !== 'production' //ÊòØÂê¶ÂºÄÂêØË∞ÉËØïÊ®°Âºè
});

router.get('/',async (ctx)=>{
    let list={
        name:'Ella',
        age:20,
        friends:['Roseanne','Jack']
    }
    await ctx.render('index',{
        list //‰º†ÈÄíÊï∞ÊçÆ
    });
});

router.get('/news',async (ctx)=>{    
    ctx.body='news';
});

app.use(router.routes());
app.use(router.allowedMethods);

app.listen(3031);
------------------------------------------------------------------------------
html:
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    first page
    
    <div>
        name:{{list.name}}
    </div>
    <!--Âà§Êñ≠Êï∞ÊçÆ-->
    <div>
        age:{{if list.age>20}} Â§ß‰∫é20 {{else}} Â∞è‰∫éÁ≠â‰∫é20 {{/if}}
    </div>
    <!--Âæ™ÁéØÊï∞ÊçÆ-->
    <div>
        friends: {{each list.friends}} {{$index}} -- {{$value}} {{/each}}
    </div>
    <!--ÂºïÂÖ•Â≠êÊ®°Áâà-->
    <div>
        {{include './public/test.html'}}
    </div>
</body>
</html>
```
        
### koa cookie
- Áî®Ê≥ï: 
   - ËÆæÁΩÆcookie:ctx.cookies.set(name,value,[[options](https://github.com/koajs/koa/blob/master/docs/api/context.md)]);
   - Ëé∑ÂèñcookieÁöÑÂÄº: ctx.cookies.get('name');
```
üå∞Ôºö
const Koa = require('koa');
const Router = require('koa-router');

let app = new Koa();
let router = new Router();

router.get('/',async (ctx)=>{
    let list={
        name:'Ella'
    }
    //Âú®koa‰∏≠Ê≤°Ê≥ïÁõ¥Êé•ËÆæÁΩÆ‰∏≠ÊñáÁöÑcookieÔºåËß£ÂÜ≥ÊñπÊ≥ïÔºö‰ΩøÁî®bufferÂ∞Ü‰∏≠ÊñáËΩ¨Êç¢Êàêbase64ÁöÑÂ≠óÁ¨¶‰∏≤ÔºåÂú®Ëé∑ÂèñÁöÑÊó∂ÂÄôÂÜçËøòÂéübase64Â≠óÁ¨¶‰∏≤
    /**‰æãÂ≠êÔºö
     * new Buffer('hello').toString('base64');//ËΩ¨Êç¢‰∏∫base64,aGVsbG8=
     * new Buffer('aGVsbG8=','base64').toString();//ËøòÂéübase64Â≠óÁ¨¶‰∏≤:hello
     */
    ctx.cookies.set('name',list.name,{
        maxAge:60*1000*24, //ËÆæÂÆöÊó∂Èó¥
        httpOnly:true //httpOnly,Ëã•‰∏∫trueÔºåÈÇ£‰πàÂè™ÊúâÂú®ÊúçÂä°Âô®ËÉΩÊü•ËØ¢Âà∞Ëøô‰∏™cookie„ÄÇËã•‰∏∫falseÔºåÂàôÊó†ËÆ∫ÊòØÂú®ÂÆ¢Êà∑Á´ØÔºà‰æãÂ¶ÇÔºöjsÔºâËøòÊòØÂú®ÊúçÂä°Âô®ÁöÜÂèØ‰ª•ËÆøÈóÆ„ÄÇ
    })
    ctx.body = 'firstPage'
});

router.get('/news',async (ctx)=>{    
    let cookiesName = ctx.cookies.get('name');
    ctx.body=cookiesName;
});

app.use(router.routes());
app.use(router.allowedMethods);

app.listen(3031);
```

### koa session
- session‰∏écookie‰∏çÂêåÂú®‰∫éÔºõsession‰øùÂ≠òÂú®ÊúçÂä°Âô®‰∏äÔºåËÄåcookie‰øùÂ≠òÂú®ÂÆ¢Êà∑Á´ØÊµèËßàÂô®‰∏≠„ÄÇ
- ÂÆâË£ÖÔºönpm install koa-session --save
- [koa sessionÁöÑ‰ΩøÁî®ÊñπÊ≥ï](https://www.npmjs.com/package/koa-session)
```
üå∞Ôºö
const Koa = require('koa');
const Router = require('koa-router');
//ÂºïÂÖ•express-session
const session = require('koa-session');

let app = new Koa();
let router = new Router();

//ÈÖçÁΩÆkoa-session‰∏≠Èó¥‰ª∂
app.keys = ['some secret hurr'];
 
const CONFIG = {
  key: 'koa.sess', /** (string) cookie key (default is koa.sess) */
  /** (number || 'session') maxAge in ms (default is 1 days) */
  /** 'session' will result in a cookie that expires when session/browser is closed */
  /** Warning: If a session cookie is stolen, this cookie will never expire */
  maxAge: 86400000, //ÔºÅÔºÅËÆæÁΩÆËøáÊúüÁöÑÊó∂Èó¥
  autoCommit: true, /** (boolean) automatically commit headers (default true) */
  overwrite: true, /** (boolean) can overwrite or not (default true) */
  httpOnly: true, /** (boolean) httpOnly or not (default true) */
  signed: true, /** (boolean) signed or not (default true) */
  rolling: false, /** ÔºÅÔºÅ(boolean) Force a session identifier cookie to be set on every response. The expiration is reset to the original maxAge, resetting the expiration countdown. (default is false) */
  renew: false, /** ÔºÅÔºÅ(boolean) renew session when session is nearly expired, so we can always keep user logged in. (default is false)*/
  secure: false, /** (boolean) secure cookie*/
  sameSite: null, /** (string) session cookie sameSite options (default null, don't set it) */
};
app.use(session(CONFIG, app));


router.get('/',async (ctx)=>{
    let list={
        name:'Ella'
    }
    ctx.session.name=list.name;
    ctx.body = 'firstPage'
});

router.get('/news',async (ctx)=>{    
    ctx.body=ctx.session.name;
});

app.use(router.routes());
app.use(router.allowedMethods);

app.listen(3031);
```

### koa Â∞ÅË£ÖmongodbÊï∞ÊçÆÂ∫ì
- 
```
üå∞Ôºö
db.js
//dbÂ∫ì
var mongoClient = require('mongodb').MongoClient;
var config = require('./config');

//Â∞ÅË£ÖÊï∞ÊçÆÂ∫ì
class Db {
    static getInstance(){ //‰ΩøÁî®Âçï‰æãÔºåÁº©Áü≠Êü•ËØ¢Êó∂Èó¥ÔºåÈÅøÂÖçÂ§öÊ¨°ÈìæÊé•Âêå‰∏ÄÊï∞ÊçÆÂ∫ìÔºåËß£ÂÜ≥Â§öÊ¨°ÂÆû‰æãÂåñÂÆû‰æã‰∏çÂÖ±‰∫´ÁöÑÈóÆÈ¢ò
        if(!Db.intance){
             Db.intance = new Db();
        }
        return  Db.intance;
       
    }
    constructor() {
        this.dbClient = '';//Â≠òÊîædbÂØπË±°
        this.connect();
    }
    //ÈìæÊé•Êï∞ÊçÆÂ∫ì
    connect() {
        return new Promise((resolve, reject) => {
            if (!this.dbClient) { //Âà§Êñ≠ÊòØÂê¶ÈìæÊé•ËøáÊï∞ÊçÆÂ∫ì
                mongoClient.connect(config.dbUrl, (err, client) => {
                    if (err) {
                        reject(err);
                    } else {
                        this.dbClient = client.db(config.dbName);
                        resolve(this.dbClient);
                    }
                })
            }else{
                resolve(this.dbClient);
            }
        })
    }
    //find
    find(collectionName, json) {
        return new Promise((resolve, reject) => {
            this.connect().then((db) => {
                let result = db.collection(collectionName).find(json);
                result.toArray((err, data) => {
                    if (err) {
                        reject(err);
                        return;
                    } else {
                        resolve(data);
                    }
                })
            })
        })

    }
    //update
    update() {

    }
    //insert
    insert() {

    }
}

var test = new Db();
test.find('students', {}).then((data) => {
    console.log(data);
});
var test1 = Db.getInstance();//‰ΩøÁî®ÈùôÊÄÅÊñπÊ≥ïËé∑ÂèñÂÆû‰æãÂØπË±°

----------------------------------------------
config.js
let app={
    dbUrl:'mongodb://admin:123456@127.0.0.1:27017',
    dbName:'student'
}

module.exports = app;
----------------------------------------------
app.js
const Koa = require('koa');
const Router = require('koa-router');
const path = require("path");
const render = require('koa-art-template');
//ÂºïÂÖ•Â∞ÅË£ÖÁ±ª
const Db = require('./modules/db');

let app = new Koa();
let router = new Router();

render(app, {
    root: path.join(__dirname, 'views'), //ËßÜÂõæÁöÑ‰ΩçÁΩÆ
    extname: '.html', //ÂêéÁºÄÂêç
    debug: process.env.NODE_ENV !== 'production' //ÊòØÂê¶ÂºÄÂêØË∞ÉËØïÊ®°Âºè
});

router.get('/', async (ctx) => {
    let list=[];
    //ÈÄöËøáÂ∞ÅË£ÖÁ±ªËé∑ÂèñÊï∞ÊçÆ
    await Db.find('students', {}).then((data) => {
        list=data;
    });
    console.log(list);
    await ctx.render('index', {
        list
    });
});
```

### koaÊâãËÑöÊû∂
- ÂÆâË£ÖÔºönpm install koa-generator -g
- ÂàõÂª∫È°πÁõÆÔºökoa koa_demo
- ÂÆâË£Ö‰æùËµñÔºönpm install
- ÂêØÂä®È°πÁõÆÔºönpm start

### koaË∑ØÁî±Ê®°ÂùóÂåñ
- Â∞ÜË∑ØÁî±Ê†πÊçÆÂäüËÉΩÁöÑ‰∏çÂêåÂàÜ‰∏∫Êï∞‰∏™Â≠êË∑ØÁî±ÔºåÂÜçÂú®app.js‰∏≠ÂºïÂÖ•ÂêÑ‰∏™Ë∑ØÁî±ÁöÑÊ®°ÂùóÔºåÂπ∂‰∏îÈÖçÁΩÆÂ≠êË∑ØÁî±„ÄÇ










