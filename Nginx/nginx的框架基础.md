# nginx的框架基础
### Nginx请求处理流程
<img alt="Nginx请求处理流程" src="" width="500px" height="300px">

- 采用非阻塞的事件驱动处理引擎，也就是采用了异步引擎，一旦使用了异步引擎，就要使用状态机识别处理请求，所以nginx中的传输层、HTTP、MAIL都是
状态机。
- 在解析出请求需要访问静态资源的时候，就需要到静态资源中寻找所需的资源。若是做反向代理的时候，又可以作为磁盘缓存，将资源缓存到磁盘上。
- 当内存不足以缓存所有的文件以及缓存信息的时候，会导致调用磁盘的时候发生阻塞的情况，所以设置了线程池来调节阻塞调用。
- 对于完成的请求，会记录其相应的Access访问日志以及Error错误日志。
- 请求可以通过HTTP状态机输入到HTTP、Mail、TCP代理中。

### Nginx的进程结构
<img alt="Nginx的进程结构" src="" width="500px" height="300px">

- Nginx分为单进程结构与多进程结构。
   - 单进程结构，只适合开发以及调试。
   - 多进程结构，更适合生产环境。
- Nginx使用多进程而不是使用多线程的原因：因为多线程使用的是同一个地址空间，若某个第三方模块引发了一个地址空间段错误时，会导致整个nginx进程
挂掉。而多进程中，每个进程都有着独立的地址空间，即使一个进程挂掉了，也不会对其他进程有影响。
#### 多进程结构
- 有一个主进程master以及多个子进程，子进程又会分为两类：Worker进程以及Cache manager进程、Cache loader进程。
   - master进程的作用：管理worker进程
   - worker进程的作用：处理请求
   - Cache manager进程、Cache loade进程的作用：在做反向代理时，为后端发送来的动态请求作缓存，Cache loader进程是缓存的载入，Cache manager
   进程是缓存的管理。
- worker进程的数量与cpu的核数有关。









