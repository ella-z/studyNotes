# Web安全攻击
- Web应用是由动态脚本、编译过的代码等组合而成，它通常架设在Web服务器上，用户在Web浏览器上发送
请求，这些请求使用HTTP协议，由Web应用和企业后台的数据库及其他动态内容通信。

### Web应用安全威胁的分类
1. 验证访问：用来确认某用户、服务或是应用身份的攻击手段。
2. 授权访问：用来决定是否某用户、服务或是应用具有执行请求动作必要权限的攻击手段。
3. 客户侧攻击：用来扰乱或是探测Web站点用户的攻击手段。
4. 命令执行：在Web站点上执行远程命令的攻击手段。
5. 信息暴露：用来获取Web站点具体系统信息的攻击手段。
6. 逻辑性攻击：用来扰乱或是探测Web应用逻辑流程的攻击手段。

### 安全漏洞

#### 验证机制安全
- 验证机制是web应用程序中最简单的一种安全机制。
- 验证机制是应用程序防御恶意攻击的核心机制，它处于安全防御的最前沿，若被用户轻易突破了，通常应用程序的全部功能、数据都会被控制，所以若缺乏了安全有效的验证机制，其他的核心安全机制都无法实施(会话管理和
访问控制)。
- 一般的验证过程🌰：应用程序必须合适用户提交的用户名和密码是否正确。正确则允许登录，否则就禁止登录。
- 典型的身份验证模式：
<br />
<img src="https://github.com/ella-z/studyNotes/blob/master/HTTP%E5%8D%8F%E8%AE%AE/images/%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81%E6%A8%A1%E5%BC%8F.PNG" alt="身份验证模式" width="400px" height="200px">

   + 验证的技术
    1. 基于HTML表单的验证
    2. 多元机制，如组合型密码（需要多次输入）
    3. 客户端ssl证书（多用于网银）
- 验证机制的漏洞
   1. 弱密码，许多web应用程序对密码的强度没有过多要求，很容易导致密码过于简单而被攻击者猜到。
   2. 暴力破解，登录功能的公开性会诱使攻击者试图猜测用户名和密码，从而获得访问应用程序的权力。如果应用程序允许攻击者用不同的密码暴力尝试，直到他找到正确的密码，那么这个应用程序就非常容易遭受攻击。
       - 执行暴力攻击的过程：
       <img src="https://github.com/ella-z/studyNotes/blob/master/HTTP%E5%8D%8F%E8%AE%AE/images/%E6%89%A7%E8%A1%8C%E6%9A%B4%E5%8A%9B%E6%94%BB%E5%87%BB.PNG" alt="执行暴力攻击的过程" width="300px" height="200px">  
      
       - 对于暴力破解的安全措施
          1. 验证码技术(最常见和有效的应对方式)
          2. Cookie和会话检测，设置一个cookie，如failedlogin=0；登录尝试失败，递增该值，达到某个上限，检测到这个值并拒绝在此处理登录，但是因为cookie在客户端，所以很容易被攻击者截取HTTP请求并修改HTTP请求的头部(cookie存储在请求的头部)。
          3. 双因子认证，双因子认证是综合个人密码和手机来达到双重认证效果。
   3. 忘记密码，忘记密码的核心问题就是忘记密码的流程跳过了身份验证。 
      - 通过邮件找回密码的功能中存在的安全问题：因为GET请求的URL里，目标email参数的是明文的 ，我们可以将任意用户的密码重置邮件发给指定的邮箱。
   4. 过于依赖MD5加密
      - 加密的内容很有可能被破解。     
   5. 多阶登录，执行多次验证检查可能会提高登录机制的安全性，但响应的，这个过程也可能存在更多的执行缺陷。
      - 可能存在设计缺陷：
         + 应用程序每个阶段相互之间没有相关性，那么攻击者很有可能直接绕到最后一个阶段，因为最后一个阶段无法确认，攻击者是否经历了前面的阶段。
         + 应用程序可能会认为每个阶段的用户身份不会发生改变，因此，并未在每个阶段都明确确认用户的身份。
         + 应用程序可能会提出一个随机选择的问题，但是问题的细节并没有保存在服务器上，而是保存在隐藏的HTML表单字段中，这个时候攻击者就可以通过修改隐藏的字段选择已经截获或已经遍历到答案的问题，进行验证登录。

#### 会话管理概述
- 会话管理机制是一个基本的安全组件，它可在用户通过请求提交他们的证书后持续向应用程序保证任何特定用户身份的真实性。
- 安全方面：若攻击者能够破坏应用程序的会话管理，他就能轻易避开其实施的验证机制，不需要用户证书即可伪装成其他应用程序用户。若攻击者以这种方式攻破一个管理用户，那么他就能控制整个程序。
<br />
<img src="https://github.com/ella-z/studyNotes/blob/master/HTTP%E5%8D%8F%E8%AE%AE/images/%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81%E6%A8%A1%E5%BC%8F.PNG" alt="身份验证模式" width="400px" height="200px">

- 会话管理更注重Session生成、Cookie的写入和读取还有验证身份。
- 会话令牌的漏洞：
   + 一些会话令牌通过用户的用户名或者电子邮件地址转换而来，或者使用与其相关的其他信息创建，这些信息可以某种方式进行编码或模糊处理，也可与其他数据结合在一起。这些令牌很容易被反解密。由此攻击者可以枚举大量用户名来生成可能有效令牌，实施攻击。
   + 一些会话令牌并不包括某个特殊用户有关的任何有意义的数据，但由于它们包含某种顺序或模式，允许攻击者通过几个令牌样本即可推断出应用程序最近发布的其他有效令牌，因此具有可预测性。即使推断过程需要做出大量尝试，并且成功率极低，但自动攻击工具也仍然能够利用这种缺陷在很短的时间内确定大量的有效令牌。
   + 尽可能缩短一个会话的寿命可降低攻击者截获、猜测或滥用有效会话令牌的可能性。其次若用户不再需要现有的会话时，终止会话为用户提供一种使其失效的途径，但有些程序并不实施有效的会话终止功能，比如只在用户的浏览器中删除了令牌，而在服务器中并没有删除这个令牌，若用户继续提交这个令牌，服务器仍然接受它。
- 一些防止会话管理漏洞的发生的方法   
   1. 令牌传输：
      - 令牌只能通过HTTPS传送。
      - 如果使用HTTP cookie传送令牌，应将这些cookie标记为secure(使得浏览器以HTTPS传送)，以防止用户浏览器通过HTTP传送它们。
   2. 增加软硬会话过期：
      - 软会话过期，它指的是用户在一定的时间内与应用系统没有交互，则会话过期，也就是Session失效。
      - 硬会话过期，它指的是用户登录到系统中经过一定的时间后，不管用户做什么，该会话都会过期。
   3. 提供完善的注销功能：
      - 用户可以手动地使当前会话过期(要保证注销不存在会话终止的漏洞)。
    
#### SQL注入原理
- SQL注入是指用户可以提交一段数据库查询代码，根据程序返回的结果，获得某些他想得知的数据。
- SQL注入攻击是指攻击者可利用SQL注入读取甚至修改数据库中保存的所有数据。
- SQL注入防御
   + 参数化查询(预处理语句)，在建立一个包含用户输入的SQL语句时分为两步：
      1. 指定查询结构，用户输入预留占位符。
      2. 指定占位符的内容。

#### XSS(跨站脚本)攻击
- XSS让攻击者能够在受害者的浏览器中执行脚本，并劫持用户会话、破坏网站或将用户重定向到恶意站点。
- 危害：
   1. 盗取各类用户账号。
   2. 控制数据。
   3. 盗取商业价值的资料。
   ...
- XSS分类
   1. 反射式XSS(非永久性XSS)
      - 它出现在服务器直接使用客户端提交的数据，如URL的数据、html表单中提交数据等，并且没有对数据进行无害化处理。
   2. 存储式XSS(永久性XSS)
      - 攻击将攻击脚本上传到Web服务器上，使得所有访问该页面的用户都会面临信息泄露的可能，其中也包括了Web服务器的管理员。
   3. 基于DOM的XSS
      - 通过js的方式执行，这种攻击常发生在应用程序每次返回相同的静态html，而通过客户端js动态生成信息，并不会跟服务端交互获取的内容。
- XSS的攻击载荷
   1. 会话令牌
      - 截取一名受害者的会话令牌，并劫持他的会话，进而作为受害者的身份来使用应用程序，执行任意操作并占有该用户的账户。
   2. 虚拟置换
      - 这种攻击需要在一个Web应用程序页面注入恶意数据，从而向应用程序对的用户传递误导性信息，比如向站点注入html，或者使用脚本注入精心设计的内容。攻击者实际上没有修改保存在服务器上的内容，而是利用程序处理并显示用户提交的输入方面的权限实现置换。
   3. 注入木马
      - 它旨在欺骗终端用户执行某种有害操作(如输入敏感数据)，然后将它们传送给攻击者。
      - 在一个明显的攻击中，攻击者注入的功能向用户显示一个木马登录表单，要求他们向攻击者控制的服务器提交他们自己的证书。
- XSS攻击的防御措施
   1. 输入验证，若应用程序在某个位置收到的用户提交的数据将来有可能被复制到它的响应中，应用程序应根据这种情形对这些数据执行尽可能严格的确认，包含数据不是太长、数据仅包含某组合法字符、数据与一个特殊的正则表达式相匹配等等。
   2. 输出编码，若应用程序将某位用户或第三方提交的数据复制到它的响应中，那么应用程序应对这些数据进行HTML编码(指用对应的HTML实体替代字面量字符)，以净化可能的恶意字符。
   
#### CSRF(跨站请求伪造)攻击
- CSRF通过伪装来自受信任用户的请求来利用受信任的网站，通过一些手段(如通过电子邮件发送一个链接)来蛊惑受害者进行一些敏感性的操作，如修改密码、转账等。
- CSRF防御措施
   1. 增加确认操作
      - 若涉及一些敏感操作的时候，对用户再次确认是否要进行此操作。
   2. 重新验证
      - 在做一些重要敏感操作的时候，要求用户重新输入密码进行二次验证，只有正确了才进行操作。
   3. 使用Token
      - 在用户刚登录的时候，产生一个新的不可预知的CSRF Token，并且把此Token存放在用户的session中，然后在任何一个需要保护的表单(转账等)中，增加一个隐藏的字段来存放这个Token，在提交此请求的时候，在服务器端检查提交的Token与用户Session中的Token是否一致，若一致，继续处理请求，否则返回一个错误信息给用户。当用户退出的时候或者Session过期的时候，用户信息(包括CSRF Token)从Session中移除并且销毁Session。
      
      
      
      
      
      
   
   
   
