# token
### ä»€ä¹ˆæ˜¯token
- tokenæ˜¯æœåŠ¡ç«¯ç”Ÿæˆçš„ä¸€ä¸²å­—ç¬¦ä¸²ï¼Œä»¥ä½œä¸ºå®¢æˆ·ç«¯è¿›è¡Œè¯·æ±‚çš„ä¸€ä¸ªä»¤ç‰Œã€‚
- Token çš„èº«ä»½éªŒè¯çš„è¿‡ç¨‹ï¼š
   1. å½“ç”¨æˆ·å®Œæˆç¬¬ä¸€æ¬¡ç™»å½•åŽï¼ŒæœåŠ¡å™¨å°±ä¼šç”Ÿæˆä¸€ä¸ªtokenï¼Œå¹¶å°†æ”¹tokenè¿”å›žåˆ°ç»™å®¢æˆ·ç«¯ã€‚
   2. å®¢æˆ·ç«¯æ”¶åˆ°tokenä¹‹åŽå¯ä»¥å°†å…¶å­˜å‚¨åˆ°Cookieé‡Œæˆ–è€…LocalStorageã€‚
   3. æ¯æ¬¡å®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡ç«¯çš„æ—¶å€™åªéœ€å¸¦ä¸Šè¿™ä¸ªtokenåˆ°æœåŠ¡ç«¯è¯·æ±‚æ•°æ®å³å¯ï¼Œä¸éœ€è¦å†å¸¦ä¸Šç”¨æˆ·åä»¥åŠå¯†ç ã€‚
   4. æœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚åŽï¼ŒåŽ»éªŒè¯å®¢æˆ·ç«¯ä¸­è¯·æ±‚ä¸­å¸¦ç€çš„tokenï¼Œå¦‚æžœéªŒè¯æˆåŠŸï¼Œå°±å‘å®¢æˆ·ç«¯è¿”å›žè¯·æ±‚çš„æ•°æ®ã€‚

### ä¸ºä»€ä¹ˆè¦ä½¿ç”¨token
- å› ä¸ºtokenèƒ½å‡è½»æœåŠ¡å™¨çš„åŽ‹åŠ›ï¼Œå‡å°‘æŸ¥è¯¢æ•°æ®åº“çš„æ¬¡æ•°ï¼Œ
- è¯·æ±‚ä¸­å‘é€tokenè€Œä¸å†æ˜¯å‘é€cookieèƒ½å¤Ÿé˜²æ­¢CSRF(è·¨ç«™è¯·æ±‚ä¼ªé€ )ã€‚
- åœ¨å®¢æˆ·ç«¯å­˜å‚¨çš„Tokensæ˜¯æ— çŠ¶æ€çš„ï¼Œå¹¶ä¸”èƒ½å¤Ÿè¢«æ‰©å±•ã€‚åŸºäºŽè¿™ç§æ— çŠ¶æ€å’Œä¸å­˜å‚¨Sessionä¿¡æ¯ï¼Œè´Ÿè½½è´Ÿè½½å‡è¡¡å™¨èƒ½å¤Ÿå°†ç”¨æˆ·ä¿¡æ¯ä»Žä¸€ä¸ªæœåŠ¡ä¼ åˆ°å…¶ä»–æœåŠ¡å™¨ä¸Šã€‚
- tokenå…·æœ‰å¯æ‰©å±•æ€§ï¼Œèƒ½å¤Ÿåˆ›å»ºä¸Žå…¶å®ƒç¨‹åºå…±äº«æƒé™çš„ç¨‹åºã€‚
- tokenå¯ä»¥å¤šå¹³å°è·¨åŸŸï¼Œ åªè¦ç”¨æˆ·æœ‰ä¸€ä¸ªé€šè¿‡äº†éªŒè¯çš„tokenï¼Œæ•°æ®å’Œèµ„æºå°±èƒ½å¤Ÿåœ¨ä»»ä½•åŸŸä¸Šè¢«è¯·æ±‚åˆ°ã€‚

### å¦‚ä½•ç”Ÿæˆtoken
- ä½¿ç”¨**JWT**ï¼Œå³JSON Web Tokensã€‚
### JWT
- JWTæ ‡å‡†çš„Tokenæœ‰ä¸‰éƒ¨åˆ†ï¼š
   - header
   - payload
   - signature
   - å„ä¸ªéƒ¨åˆ†ä¹‹é—´ä¼šç”¨ç‚¹åˆ†å¼€ï¼Œå¹¶ä¸”éƒ½ä¼šä½¿ç”¨Base64ç¼–ç ã€‚
#### Header
- Headerä¸»è¦æœ‰ä¸¤éƒ¨åˆ†çš„å†…å®¹ï¼š
   1. Tokençš„ç±»åž‹ã€‚
   2. ä½¿ç”¨çš„ç®—æ³•
   ```
   ðŸŒ°ï¼š
   {
      "typ" : "JWT",
      "alg" : "HS256"
   }
   ```
#### Payload
- Payloadä¸­å­˜å‚¨ç€Tokençš„å…·ä½“å†…å®¹ï¼Œè¿™äº›å†…å®¹ä¸­æœ‰ä¸€äº›æ ‡å‡†çš„å­—æ®µï¼š
   - issï¼šIssuerï¼Œå‘è¡Œè€…
   - subï¼šSubjectï¼Œä¸»é¢˜
   - audï¼šAudienceï¼Œè§‚ä¼—
   - expï¼šExpiration timeï¼Œè¿‡æœŸæ—¶é—´
   - nbfï¼šNot before
   - iatï¼šIssued atï¼Œå‘è¡Œæ—¶é—´
   - jtiï¼šJWT ID
   
#### Signature
- Signatureç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼Œå…ˆä½¿ç”¨Base64 ç¼–ç çš„ header å’Œ payload ç»„åˆæˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå†å°†è¿™ä¸ªå­—ç¬¦ä¸²ç”¨åŠ å¯†ç®—æ³•åŠ å¯†ä¸€ä¸‹ï¼Œåœ¨åŠ å¯†çš„æ—¶å€™è¦åŠ å…¥ä¸€ä¸ªSecret(ç›¸å½“äºŽå¯†ç )ï¼Œè¿™ä¸ªSecretä¼šå­˜å‚¨åœ¨æœåŠ¡ç«¯ã€‚
```
var encodedString = base64UrlEncode(header) + "." + base64UrlEncode(payload); 
HMACSHA256(encodedString, 'secret');
```
- æœ€åŽåœ¨æœåŠ¡ç«¯æ”¶åˆ°çš„tokenå°±æ˜¯ç”±è¿™ä¸‰éƒ¨åˆ†ç»„æˆã€‚

### tokençš„åº”ç”¨
- tokenä¸€èˆ¬å¼•ç”¨åœ¨ä¸¤ä¸ªæ–¹é¢
   1. é˜²æ­¢è¡¨å•é‡å¤æäº¤
   2. é˜²æ­¢CSRFæ”»å‡»ï¼Œå³è·¨ç«™ç‚¹è¯·æ±‚ä¼ªé€ 
- è¿™ä¸¤ä¸ªåŽŸç†ä¸Šéƒ½æ˜¯é€šè¿‡ session + tokenæ¥å®žçŽ°çš„ã€‚
- å½“å®¢æˆ·ç«¯è¯·æ±‚é¡µé¢æ—¶ï¼ŒæœåŠ¡å™¨ä¼šç”Ÿæˆä¸€ä¸ªéšæœºæ•°Tokenï¼Œå¹¶ä¸”å°† Token æ”¾ç½®åˆ° session å½“ä¸­ï¼Œç„¶åŽå°† Token å‘ç»™å®¢æˆ·ç«¯ã€‚ä¸‹æ¬¡å®¢æˆ·ç«¯æäº¤è¯·æ±‚æ—¶ï¼ŒToken ä¼šéšç€è¡¨å•ä¸€èµ·æäº¤åˆ°æœåŠ¡å™¨ç«¯ã€‚
- å¯¹äºŽé˜²æ­¢CSRFæ”»å‡»ï¼ŒæœåŠ¡å™¨ç«¯ä¼šå¯¹ Token å€¼è¿›è¡ŒéªŒè¯ï¼Œåˆ¤æ–­æ˜¯å¦å’Œsessionä¸­çš„Tokenå€¼ç›¸ç­‰ã€‚è‹¥ç›¸ç­‰ï¼Œåˆ™å¯ä»¥è¯å®žè¯·æ±‚æ˜¯æœ‰æ•ˆçš„ã€‚
- å¯¹äºŽé˜²æ­¢è¡¨å•é‡å¤æäº¤ï¼ŒæœåŠ¡å™¨ç«¯ç¬¬ä¸€æ¬¡éªŒè¯ç›¸åŒè¿‡åŽï¼Œä¼šå°† session ä¸­çš„Tokenå€¼æ›´æ–°ï¼Œè‹¥ç”¨æˆ·é‡å¤æäº¤ï¼Œç¬¬äºŒæ¬¡çš„éªŒè¯åˆ¤æ–­å°†å¤±è´¥ï¼Œå› ä¸ºç”¨æˆ·æäº¤çš„è¡¨å•ä¸­çš„ Token æ²¡å˜ï¼Œä½†æœåŠ¡å™¨ç«¯ session ä¸­ Token å·²ç»æ”¹å˜äº†ã€‚
- ä½¿ç”¨session + tokenæ–¹æ³•çš„ç¼ºç‚¹ï¼šå½“å¤šé¡µé¢å¤šè¯·æ±‚æ—¶ï¼Œå¿…é¡»é‡‡ç”¨å¤šTokenåŒæ—¶ç”Ÿæˆçš„æ–¹æ³•ï¼Œè¿™æ ·å ç”¨æ›´å¤šèµ„æºï¼Œæ‰§è¡Œæ•ˆçŽ‡ä¼šé™ä½Žã€‚å¯ä»¥ä½¿ç”¨ cookie +token ä»£æ›¿session + tokenï¼Œä½†æ˜¯è‹¥tokenå­˜å‚¨åœ¨cookieä¸­å®¹æ˜“é­å—XSSæ”»å‡»ã€‚


- å‚è€ƒï¼š
   > https://www.cnblogs.com/lufeiludaima/p/pz20190203.html

   > https://blog.csdn.net/qq_35246620/article/details/55049812
